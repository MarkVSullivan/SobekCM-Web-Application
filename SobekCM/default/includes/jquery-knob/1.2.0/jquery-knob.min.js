/*!jQuery Knob*/
(function(n){"use strict";var t={},i=Math.max,r=Math.min;t.c={};t.c.d=n(document);t.c.t=function(n){return n.originalEvent.touches.length-1};t.o=function(){var i=this;this.o=null;this.$=null;this.i=null;this.g=null;this.v=null;this.cv=null;this.x=0;this.y=0;this.$c=null;this.c=null;this.t=0;this.isInit=!1;this.fgColor=null;this.pColor=null;this.dH=null;this.cH=null;this.eH=null;this.rH=null;this.run=function(){var t=function(n,t){for(var r in t)i.o[r]=t[r];i.init();i._configure()._draw()};if(!this.$.data("kontroled"))return this.$.data("kontroled",!0),this.extend(),this.o=n.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:!0,readOnly:this.$.data("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:this.$.data("displayinput")==null||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor")||this.$.data("fgcolor")||"#87CEEB",inline:!1,step:this.$.data("step")||1,draw:null,change:null,cancel:null,release:null},this.o),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var r=n(this);i.i[t]=r;i.v[t]=r.val();r.bind("change",function(){var n={};n[t]=r.val();i.val(n)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.$.val(),this.v==""&&(this.v=this.o.min),this.$.bind("change",function(){i.val(i._validate(i.$.val()))})),this.o.displayInput||this.$.hide(),this.$c=n('<canvas width="'+this.o.width+'px" height="'+this.o.height+'px"><\/canvas>'),this.c=this.$c[0].getContext("2d"),this.$.wrap(n('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"><\/div>')).before(this.$c),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this._draw(),this};this._draw=function(){var t=!0,n=document.createElement("canvas");n.width=i.o.width;n.height=i.o.height;i.g=n.getContext("2d");i.clear();i.dH&&(t=i.dH());t!==!1&&i.draw();i.c.drawImage(n,0,0);n=null};this._touch=function(n){var r=function(n){var t=i.xy2val(n.originalEvent.touches[i.t].pageX,n.originalEvent.touches[i.t].pageY);t!=i.cv&&(i.cH&&i.cH(t)===!1||(i.change(i._validate(t)),i._draw()))};return this.t=t.c.t(n),r(n),t.c.d.bind("touchmove.k",r).bind("touchend.k",function(){(t.c.d.unbind("touchmove.k touchend.k"),i.rH&&i.rH(i.cv)===!1)||i.val(i.cv)}),this};this._mouse=function(n){var r=function(n){var t=i.xy2val(n.pageX,n.pageY);t!=i.cv&&(i.cH&&i.cH(t)===!1||(i.change(i._validate(t)),i._draw()))};return r(n),t.c.d.bind("mousemove.k",r).bind("keyup.k",function(n){if(n.keyCode===27){if(t.c.d.unbind("mouseup.k mousemove.k keyup.k"),i.eH&&i.eH()===!1)return;i.cancel()}}).bind("mouseup.k",function(){(t.c.d.unbind("mousemove.k mouseup.k keyup.k"),i.rH&&i.rH(i.cv)===!1)||i.val(i.cv)}),this};this._xy=function(){var n=this.$c.offset();return this.x=n.left,this.y=n.top,this};this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(n){n.preventDefault();i._xy()._mouse(n)}).bind("touchstart",function(n){n.preventDefault();i._xy()._touch(n)}),this.listen()),this};this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this};this._clear=function(){this.$c[0].width=this.$c[0].width};this._validate=function(n){return~~((n<0?-.5:.5)+n/this.o.step)*this.o.step};this.listen=function(){};this.extend=function(){};this.init=function(){};this.change=function(){};this.val=function(){};this.xy2val=function(){};this.draw=function(){};this.clear=function(){this._clear()};this.h2rgba=function(n,t){var i;return n=n.substring(1,7),i=[parseInt(n.substring(0,2),16),parseInt(n.substring(2,4),16),parseInt(n.substring(4,6),16)],"rgba("+i[0]+","+i[1]+","+i[2]+","+t+")"};this.copy=function(n,t){for(var i in n)t[i]=n[i]}};t.Dial=function(){t.o.call(this);this.startAngle=null;this.xy=null;this.radius=null;this.lineWidth=null;this.cursorExt=null;this.w2=null;this.PI2=2*Math.PI;this.extend=function(){this.o=n.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)};this.val=function(n){if(null!=n)this.cv=this.o.stopper?i(r(n,this.o.max),this.o.min):n,this.v=this.cv,this.$.val(this.v),this._draw();else return this.v};this.xy2val=function(n,t){var u,f;return u=Math.atan2(n-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset,this.angleArc!=this.PI2&&u<0&&u>-.5?u=0:u<0&&(u+=this.PI2),f=~~(.5+u*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(f=i(r(f,this.o.max),this.o.min)),f};this.listen=function(){var t=this,o=function(n){n.preventDefault();var i=n.originalEvent,r=i.detail||i.wheelDeltaX,u=i.detail||i.wheelDeltaY,f=parseInt(t.$.val())+(r>0||u>0?t.o.step:r<0||u<0?-t.o.step:0);t.cH&&t.cH(f)===!1||t.val(f)},f,u,e=1,s={37:-t.o.step,38:t.o.step,39:t.o.step,40:-t.o.step};this.$.bind("keydown",function(o){var h=o.keyCode,c;h>=96&&h<=105&&(h=o.keyCode=h-48);f=parseInt(String.fromCharCode(h));isNaN(f)&&(h!==13&&h!==8&&h!==9&&h!==189&&o.preventDefault(),n.inArray(h,[37,38,39,40])>-1&&(o.preventDefault(),c=parseInt(t.$.val())+s[h]*e,t.o.stopper&&(c=i(r(c,t.o.max),t.o.min)),t.change(c),t._draw(),u=window.setTimeout(function(){e*=2},30)))}).bind("keyup",function(){isNaN(f)?u&&(window.clearTimeout(u),u=null,e=1,t.val(t.$.val())):t.$.val()>t.o.max&&t.$.val(t.o.max)||t.$.val()<t.o.min&&t.$.val(t.o.min)});this.$c.bind("mousewheel DOMMouseScroll",o);this.$.bind("mousewheel DOMMouseScroll",o)};this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min);this.$.val(this.v);this.w2=this.o.width/2;this.cursorExt=this.o.cursor/100;this.xy=this.w2;this.lineWidth=this.xy*this.o.thickness;this.lineCap=this.o.lineCap;this.radius=this.xy-this.lineWidth/2;this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset);this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc);this.angleOffset=this.o.angleOffset*Math.PI/180;this.angleArc=this.o.angleArc*Math.PI/180;this.startAngle=1.5*Math.PI+this.angleOffset;this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var n=i(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.o.width/2+4>>0)+"px",height:(this.o.width/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.o.width/3>>0)+"px","margin-left":"-"+(this.o.width*3/4+2>>0)+"px",border:0,background:"none",font:"bold "+(this.o.width/n>>0)+"px Arial","text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})};this.change=function(n){this.cv=n;this.$.val(n)};this.angle=function(n){return(n-this.o.min)*this.angleArc/(this.o.max-this.o.min)};this.draw=function(){var n=this.g,e=this.angle(this.cv),r=this.startAngle,i=r+e,u,t,f=1;n.lineWidth=this.lineWidth;n.lineCap=this.lineCap;this.o.cursor&&(r=i-this.cursorExt)&&(i=i+this.cursorExt);n.beginPath();n.strokeStyle=this.o.bgColor;n.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,!0);n.stroke();this.o.displayPrevious&&(t=this.startAngle+this.angle(this.v),u=this.startAngle,this.o.cursor&&(u=t-this.cursorExt)&&(t=t+this.cursorExt),n.beginPath(),n.strokeStyle=this.pColor,n.arc(this.xy,this.xy,this.radius,u,t,!1),n.stroke(),f=this.cv==this.v);n.beginPath();n.strokeStyle=f?this.o.fgColor:this.fgColor;n.arc(this.xy,this.xy,this.radius,r,i,!1);n.stroke()};this.cancel=function(){this.val(this.v)}};n.fn.dial=n.fn.knob=function(i){return this.each(function(){var r=new t.Dial;r.o=i;r.$=n(this);r.run()}).parent()}})(jQuery)